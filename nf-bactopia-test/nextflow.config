manifest {
    name = "nf-bactopia-test"
    contributors = [
        [name: "Robert A. Petit III", contribution: ["AUTHOR"]],
    ]
    homePage = "https://github.com/bactopia/nf-bactopia"
    description = "Test pipeline for nf-bactopia"
    mainScript = "main.nf"
    nextflowVersion = "!>=25.04.0"
    version = "0.1.0"
    license = "https://spdx.org/licenses/Apache-2.0"
}

params {
    workflow {
        name = "sccmec"
        logo_name = "bactopia-tools"
        description = "A tool for SCCmec typing of Staphylococcus aureus genomes"
        ext = "fna"
    }
}

// Version
params.bactopia_version = '4.0.0'
manifest.version = "${params.bactopia_version}"

// Includes
params.bactopia_cache = env("BACTOPIA_CACHEDIR") ? "${env('BACTOPIA_CACHEDIR')}" : "${env('HOME')}/.bactopia"
includeConfig "./conf/params.config"
includeConfig "./conf/params/bactopia-tools.config"
includeConfig "./conf/base.config"
includeConfig "./conf/profiles.config"

// Module specific config
includeConfig "./modules/sccmec/params.config"
includeConfig "./modules/csvtk/concat/params.config"

// Set output directory
outputDir = params.outdir
workflow.output.mode = params.publish_dir_mode
workflow.output.overwrite = params.force

// Set up run directory
params.singularity_cache = env("NXF_SINGULARITY_CACHEDIR") ? "${env('NXF_SINGULARITY_CACHEDIR')}" : "${params.singularity_cache}"
params.run_timestamp = new java.util.Date().format('yyyyMMdd-HHmmss')
params.rundir = params.is_ci ? "bactopia-runs/${params.run_name}" : "bactopia-runs/${params.run_name}-${params.run_timestamp}"
params.infodir = "${params.outdir}/${params.rundir}/nf-reports"
includeConfig "./modules/sccmec/process.config"
includeConfig "./modules/csvtk/concat/process.config"

// Load nf-core custom profiles from different Institutions
includeConfig !env('NXF_OFFLINE') && params.custom_config_base ? "${params.custom_config_base}/nfcore_custom.config" : "/dev/null"

// Load Bactopia custom profiles from different institutions.
// Uncomment in the event a bactopia specific profile is added
//includeConfig !System.getenv('NXF_OFFLINE') && params.custom_config_base ? "${params.custom_config_base}/pipeline/bactopia.config" : "/dev/null"

// Reporting configuration
timeline {
    enabled = true
    overwrite = true
    file = "${params.infodir}/${params.workflow.name}-timeline.html"
}

report {
    enabled = true
    overwrite = true
    file = "${params.infodir}/${params.workflow.name}-report.html"
}

trace {
    enabled = true
    overwrite = true
    file = "${params.infodir}/${params.workflow.name}-trace.txt"
    fields = 'task_id,hash,native_id,process,tag,name,status,exit,module,container,cpus,time,disk,memory,attempt,start,complete,duration,realtime,queue,%cpu,%mem,rss,vmem'
}

dag {
    enabled = true
    overwrite = true
    file = "${params.infodir}/${params.workflow.name}-dag.svg"
}

// Plugins
plugins {
    id 'nf-bactopia'
}

bactopia {
    parametersSchema = "${projectDir}/nextflow_schema.json"
}
